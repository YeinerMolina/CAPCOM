<div class="container">
  <div class="contenedor__banner">
    <div class="details">
      <h2>SISTEMA DE PROTECCIÓN EXTERNA CONTRA RAYOS</h2>
    </div>
  </div>

  <p-card>
    <div class="container_form">
      <p-tabView [(activeIndex)]="activeIndex" #tabView>
        <p-tabPanel header="Datos iniciales">
          <ng-container *ngTemplateOutlet="datosIniciales"></ng-container>
        </p-tabPanel>
        <p-tabPanel header="Resultados">
          <ng-container *ngTemplateOutlet="resultados"></ng-container>
          <ng-container *ngTemplateOutlet="canvasTemplate"></ng-container>
        </p-tabPanel>
      </p-tabView>
    </div>
  </p-card>
</div>

<ng-template #datosIniciales [formGroup]="form">
  <div class="flex flex-column h-full pr-6">
    <div class="field pt-3 flex w-3">
      <div class="flex-auto">
        <span class="p-float-label">
          <p-dropdown class="w-full" formControlName="nivelRiesgo" [style]="{ minWidth: '100%', maxWidth: '100%' }"
            [options]="proteccionForm.nivelRiesgo" optionLabel="name" optionValue="value"
            placeholder="Nivel de protección"></p-dropdown>
          <label> Nivel de protección </label>
        </span>
        <small class="p-error" *ngIf="validateField('nivelRiesgo')">
          Campo invalido
        </small>
      </div>
    </div>
    <!-- <strong> Ingrese los datos de los bloques a proteger </strong> -->
    <div class="col-12 flex flex-column justify-content-center align-content-center">
      <p-table formArrayName="bloques" [value]="formBloques.controls">
        <ng-template pTemplate="header">
          <tr>
            <th>Altura</th>
            <th>Largo</th>
            <th>Ancho</th>
            <th>Longitud de la punta de captación</th>
            <!-- <th>Eliminar</th> -->
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-form let-rowIndex="rowIndex">
          <tr [formGroup]="form">
            <td class="field pt-3">
              <div class="p-inputgroup">
                <p-inputNumber mode="decimal" formControlName="alto" [useGrouping]="false"></p-inputNumber>
                <span class="p-inputgroup-addon">m</span>
              </div>
              <small class="p-error" *ngIf="validateField('alto', rowIndex)">
                Campo invalido
              </small>
            </td>
            <td class="field pt-3">
              <div class="p-inputgroup">
                <p-inputNumber mode="decimal" formControlName="largo" [useGrouping]="false"></p-inputNumber>
                <span class="p-inputgroup-addon">m</span>
              </div>
              <small class="p-error" *ngIf="validateField('largo', rowIndex)">
                Campo invalido
              </small>
            </td>
            <td class="field pt-3">
              <div class="p-inputgroup">
                <p-inputNumber mode="decimal" formControlName="ancho" [useGrouping]="false"></p-inputNumber>
                <span class="p-inputgroup-addon">m</span>
              </div>
              <small class="p-error" *ngIf="validateField('ancho', rowIndex)">
                Campo invalido
              </small>
            </td>
            <td class="field pt-3">
              <div class="p-inputgroup">
                <p-inputNumber mode="decimal" [maxFractionDigits]="2" formControlName="longitudPunta"
                  [useGrouping]="false"></p-inputNumber>
                <span class="p-inputgroup-addon">m</span>
              </div>
              <small class="p-error" *ngIf="validateField('longitudPunta', rowIndex)">
                Campo invalido
              </small>
            </td>
            <!-- <td class="flex justify-content-center">
              <p-button icon="pi pi-trash" (click)="deleteBloq(rowIndex)">
              </p-button>
            </td> -->
          </tr>
        </ng-template>
      </p-table>

    </div>
    <!-- <div class="flex w-full justify-content-start pr-3 pt-2">
      <p-button (onClick)="agregarBloque()" label="Agregar bloque"></p-button>
    </div> -->

    <div class="flex w-full justify-content-end pr-3 pt-2">
      <p-button (onClick)="calcular()" label="Diseñar"></p-button>
    </div>
  </div>
</ng-template>

<ng-template #canvasTemplate>
  <canvas class=" w-full max-h-30rem  h-full" #canvas></canvas>
</ng-template>

<ng-template #resultados>

</ng-template>